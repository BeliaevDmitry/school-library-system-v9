<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title>Сводная инвентаризация</title>
  <link rel="stylesheet" th:href="@{/css/app.css}">
<script th:src="@{/js/table-filters.js}" defer></script></head>
<body>
<div class="container">
  <div class="top-back"><a th:href="@{/admin/dashboard}">← Назад</a></div>
  <h2>Сводная инвентаризация</h2>
  <p class="muted">Проверка: всего ?= свободно + выдано + в кабинетах. Несовпадения подсвечены.</p>
  <div class="card">
    <p th:text="${'Проблемных строк: ' + problems}"></p>
    <table>
      <tr>
        <th>Корпус</th><th>Параллель</th><th>Предмет</th><th>Учебник</th>
        <th>Всего</th><th>Свободно</th><th>Выдано</th><th>В кабинетах</th><th>Ожидаемо</th><th>Разница</th><th>СУУФ</th><th>МЭШ</th><th>Разрешён приказом</th><th>Примечание</th>
      </tr>
      <tr th:each="r : ${rows}" th:classappend="${r.diff != 0} ? 'warn' : ''">
        <td th:text="${r.buildingName}"></td>
        <td th:text="${r.grade}"></td>
        <td th:text="${r.subject}"></td>
        <td th:text="${r.title}"></td>
        <td th:text="${r.total}"></td>
        <td th:text="${r.available}"></td>
        <td th:text="${r.issuedToStudents}"></td>
        <td th:text="${r.inCabinets}"></td>
        <td th:text="${r.expectedTotal}"></td>
        <td th:text="${r.diff}"></td>
        <td th:text="${r.suufTotal}"></td>
        <td th:text="${r.meshTotal}"></td>
        <td>
          <form th:action="@{'/admin/stocks/' + ${r.stockId} + '/approval'}" method="post" style="display:flex; gap:8px; align-items:center;">
            <select name="approvedByOrder">
              <option value="true" th:selected="${r.approvedByOrder}">Да</option>
              <option value="false" th:selected="${!r.approvedByOrder}">Нет</option>
            </select>
            <button type="submit">Сохранить</button>
          </form>
        </td>
        <td th:text="${r.note}"></td>
      </tr>
    </table>
  </div>
  <p><a th:href="@{/admin/dashboard}">← Назад</a></p>
</div>
</body>
</html>
